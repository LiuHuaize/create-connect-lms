# è¯¾ç¨‹ä¿å­˜é€»è¾‘ä¼˜åŒ–é‡æ„æ–¹æ¡ˆ

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
- ç§»é™¤å¤æ‚çš„è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼Œç®€åŒ–ä¸ºæ‰‹åŠ¨ä¿å­˜
- å‡å°‘ä¸å¿…è¦çš„çŠ¶æ€ç®¡ç†ï¼Œé™ä½å†…å­˜å ç”¨
- ç»Ÿä¸€ä¿å­˜é€»è¾‘ï¼Œé¿å…ä»£ç é‡å¤
- æå‡ä¿å­˜æ€§èƒ½ï¼Œé¿å…out of memoryé—®é¢˜

## ğŸ“Š å½“å‰é—®é¢˜åˆ†æ

### ä¸»è¦é—®é¢˜
1. **çŠ¶æ€è¿‡å¤š**ï¼š15+ ä¸ªä¿å­˜ç›¸å…³çŠ¶æ€
2. **é€»è¾‘å¤æ‚**ï¼šè‡ªåŠ¨ä¿å­˜ã€å†å²è®°å½•ã€å˜æ›´æ£€æµ‹ç­‰
3. **å†…å­˜æ³„æ¼**ï¼šæ·±æ‹·è´ã€é¢‘ç¹useEffectã€refæ»¥ç”¨
4. **ä»£ç é‡å¤**ï¼šå¤šä¸ªä¿å­˜å…¥å£ï¼Œé€»è¾‘åˆ†æ•£

### å½±å“
- é¢‘ç¹è§¦å‘é‡æ–°æ¸²æŸ“
- å†…å­˜å ç”¨è¿‡é«˜å¯¼è‡´å´©æºƒ
- ä¿å­˜é€»è¾‘éš¾ä»¥è°ƒè¯•å’Œç»´æŠ¤

---

## ğŸ”„ é‡æ„æ­¥éª¤

### **ç¬¬ä¸€æ­¥ï¼šç§»é™¤è‡ªåŠ¨ä¿å­˜ç›¸å…³ä»£ç **

#### ğŸ¯ ç›®æ ‡
å®Œå…¨ç§»é™¤è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œç®€åŒ–çŠ¶æ€ç®¡ç†

#### ğŸ“‹ å¾…åˆ é™¤çš„çŠ¶æ€
```typescript
// åœ¨ useCourseCreator.ts ä¸­åˆ é™¤
const [isAutoSaving, setIsAutoSaving] = useState(false);
const [lastSaved, setLastSaved] = useState<Date | null>(null);
const [autoSaveEnabled, setAutoSaveEnabled] = useState(false);
const autoSaveTimeoutRef = useRef<NodeJS.Timeout | null>(null);
const previousCourseRef = useRef<Course | null>(null);
const previousModulesRef = useRef<CourseModule[] | null>(null);
```

#### ğŸ“‹ å¾…åˆ é™¤çš„å‡½æ•°
```typescript
// åˆ é™¤è¿™äº›å¤æ‚çš„è‡ªåŠ¨ä¿å­˜å‡½æ•°
const handleAutoSave = async () => { /* å¤æ‚é€»è¾‘ */ };
const checkForChanges = () => { /* æ·±åº¦å¯¹æ¯”é€»è¾‘ */ };
```

#### ğŸ“‹ å¾…åˆ é™¤çš„useEffect
```typescript
// åˆ é™¤è‡ªåŠ¨ä¿å­˜ç›‘å¬å™¨
useEffect(() => {
  if (!autoSaveEnabled) return;
  if (isLoading || !moduleDataLoaded) return;
  // ... å¤æ‚çš„å˜æ›´æ£€æµ‹é€»è¾‘
}, [course, modules, autoSaveEnabled]);
```

#### âœ… æ£€æµ‹æ–¹æ³•
1. æœç´¢æ‰€æœ‰åŒ…å« `autoSave`ã€`Auto`ã€`previousRef` çš„ä»£ç 
2. è¿è¡Œ `npm run build` ç¡®ä¿æ²¡æœ‰ç¼–è¯‘é”™è¯¯
3. æµ‹è¯•ä¿å­˜æŒ‰é’®æ˜¯å¦æ­£å¸¸å·¥ä½œ

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. åˆ›å»ºæ–°è¯¾ç¨‹ï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®
2. ç¼–è¾‘ç°æœ‰è¯¾ç¨‹ï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®
3. ç¡®è®¤æ²¡æœ‰è‡ªåŠ¨ä¿å­˜ç›¸å…³çš„toastæç¤º

---

### **ç¬¬äºŒæ­¥ï¼šç®€åŒ–è¯¾ç¨‹åˆ›å»ºå™¨Hook**

#### ğŸ¯ ç›®æ ‡
å°† `useCourseCreator` ä» 894 è¡Œç²¾ç®€è‡³çº¦ 200 è¡Œ

#### ğŸ“‹ ä¿ç•™çš„æ ¸å¿ƒçŠ¶æ€
```typescript
// åªä¿ç•™è¿™äº›å¿…è¦çŠ¶æ€
const [course, setCourse] = useState<Course>({...});
const [modules, setModules] = useState<CourseModule[]>([]);
const [currentLesson, setCurrentLesson] = useState<Lesson | null>(null);
const [expandedModule, setExpandedModule] = useState<string | null>(null);
const [isLoading, setIsLoading] = useState(false);
const [isSaving, setIsSaving] = useState(false);
```

#### ğŸ“‹ ç§»é™¤çš„å¤æ‚åŠŸèƒ½
- å†å²è®°å½•ï¼ˆæ’¤é”€/é‡åšï¼‰
- å˜æ›´æ£€æµ‹
- è‡ªåŠ¨ä¿å­˜çŠ¶æ€åŒæ­¥
- å¤æ‚çš„å†…å­˜ä¼˜åŒ–

#### âœ… æ£€æµ‹æ–¹æ³•
1. ç»Ÿè®¡Hookä»£ç è¡Œæ•°ï¼š`wc -l useCourseCreator.ts`
2. æ£€æŸ¥çŠ¶æ€æ•°é‡ï¼Œç¡®ä¿ â‰¤ 6 ä¸ª
3. éªŒè¯åŸºæœ¬åŠŸèƒ½ï¼šåŠ è½½ã€ç¼–è¾‘ã€ä¿å­˜

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. åŠ è½½è¯¾ç¨‹ï¼šURLå¸¦ `?id=xxx` å‚æ•°
2. ç¼–è¾‘è¯¾ç¨‹ï¼šä¿®æ”¹æ ‡é¢˜ã€æè¿°
3. æ·»åŠ æ¨¡å—å’Œè¯¾æ—¶
4. ä¿å­˜åŠŸèƒ½æ­£å¸¸

---

### **ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç»Ÿä¸€çš„ä¿å­˜Service**

#### ğŸ¯ ç›®æ ‡
å°†åˆ†æ•£çš„ä¿å­˜é€»è¾‘ç»Ÿä¸€åˆ°ä¸€ä¸ªç®€å•çš„serviceä¸­

#### ğŸ“ åˆ›å»ºæ–°æ–‡ä»¶ï¼š`src/services/simpleCourseService.ts`
```typescript
interface SaveCourseRequest {
  course: Course;
  modules: CourseModule[];
}

class SimpleCourseService {
  async saveCourse(request: SaveCourseRequest): Promise<Course> {
    // 1. ä¿å­˜è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯
    // 2. ä¿å­˜æ¨¡å—
    // 3. ä¿å­˜è¯¾æ—¶
    // ç®€å•ç›´æ¥ï¼Œæ— å¤æ‚ä¼˜åŒ–
  }
}
```

#### ğŸ“‹ ç§»é™¤çš„å¤æ‚é€»è¾‘
- æ‰¹é‡å¤„ç†é€»è¾‘
- å†…å­˜ä¼˜åŒ–ä»£ç 
- å¹‚ç­‰æ€§å¤„ç†
- å˜æ›´æ£€æµ‹

#### âœ… æ£€æµ‹æ–¹æ³•
1. æ–°serviceæ–‡ä»¶ < 100 è¡Œä»£ç 
2. åªæœ‰ä¸€ä¸ªå…¬å…±æ–¹æ³• `saveCourse`
3. æ— å¤æ‚çš„é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. ä¿å­˜ç©ºè¯¾ç¨‹ï¼ˆåªæœ‰æ ‡é¢˜ï¼‰
2. ä¿å­˜å¸¦æ¨¡å—çš„è¯¾ç¨‹
3. ä¿å­˜å®Œæ•´è¯¾ç¨‹ï¼ˆæ¨¡å—+è¯¾æ—¶ï¼‰
4. æ£€æŸ¥æ•°æ®åº“æ•°æ®æ­£ç¡®æ€§

---

### **ç¬¬å››æ­¥ï¼šç®€åŒ–ä¿å­˜Hook**

#### ğŸ¯ ç›®æ ‡
å°† `useCourseSave` ä» 275 è¡Œç®€åŒ–è‡³çº¦ 50 è¡Œ

#### ğŸ“‹ ç®€åŒ–åçš„Hookç»“æ„
```typescript
export const useSimpleCourseSave = (course: Course, modules: CourseModule[]) => {
  const [isSaving, setIsSaving] = useState(false);
  
  const saveCourse = async () => {
    // ç®€å•çš„ä¿å­˜é€»è¾‘ï¼Œæ— å¤æ‚ä¼˜åŒ–
  };
  
  return { isSaving, saveCourse };
};
```

#### ğŸ“‹ ç§»é™¤çš„åŠŸèƒ½
- å¤§å‹å†…å®¹æ£€æµ‹
- æ‰¹é‡å¤„ç†
- å†…å­˜ç®¡ç†
- å¤æ‚é”™è¯¯å¤„ç†

#### âœ… æ£€æµ‹æ–¹æ³•
1. Hookä»£ç  < 50 è¡Œ
2. åªè¿”å› 2 ä¸ªå€¼ï¼š`isSaving`, `saveCourse`
3. æ— å¤æ‚çš„ä¾èµ–æ³¨å…¥

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. ä¿å­˜æŒ‰é’®æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€
2. ä¿å­˜æœŸé—´æŒ‰é’®ç¦ç”¨
3. ä¿å­˜æˆåŠŸåtoastæç¤º
4. ä¿å­˜å¤±è´¥åé”™è¯¯æç¤º

---

### **ç¬¬äº”æ­¥ï¼šæ¸…ç†ç›¸å…³æ–‡ä»¶**

#### ğŸ¯ ç›®æ ‡
åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶å’Œä»£ç 

#### ğŸ“‹ å¯ä»¥åˆ é™¤çš„æ–‡ä»¶
```bash
src/hooks/useCourseAutoSave.ts      # è‡ªåŠ¨ä¿å­˜Hook
src/hooks/useCourseHistory.ts       # å†å²è®°å½•Hookï¼ˆå¦‚æœå­˜åœ¨ï¼‰
src/hooks/useLocalBackup.ts         # æœ¬åœ°å¤‡ä»½Hook
src/utils/memoryUtils.ts            # å†…å­˜ä¼˜åŒ–å·¥å…·
```

#### ğŸ“‹ å¯ä»¥ç®€åŒ–çš„æ–‡ä»¶
```bash
src/stores/courseStore.ts           # ç§»é™¤è‡ªåŠ¨ä¿å­˜çŠ¶æ€
src/components/course/creator/CourseHeader.tsx  # ç§»é™¤è‡ªåŠ¨ä¿å­˜UI
```

#### âœ… æ£€æµ‹æ–¹æ³•
1. æœç´¢åˆ é™¤æ–‡ä»¶çš„å¼•ç”¨ï¼Œç¡®ä¿æ— é—ç•™
2. è¿è¡Œ `npm run build` æ— é”™è¯¯
3. Bundleå¤§å°å‡å°‘

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. å®Œæ•´çš„è¯¾ç¨‹åˆ›å»ºæµç¨‹
2. è¯¾ç¨‹ç¼–è¾‘æµç¨‹
3. ä¿å­˜åŠŸèƒ½æ­£å¸¸
4. é¡µé¢æ— æ§åˆ¶å°é”™è¯¯

---

### **ç¬¬å…­æ­¥ï¼šä¼˜åŒ–æŸ¥è¯¢ç­–ç•¥**

#### ğŸ¯ ç›®æ ‡
å‡å°‘ä¸å¿…è¦çš„APIè¯·æ±‚å’ŒçŠ¶æ€åˆ·æ–°

#### ğŸ“‹ React Queryé…ç½®ä¼˜åŒ–
```typescript
const queryConfig = {
  staleTime: 5 * 60 * 1000,      // 5åˆ†é’Ÿå†…ä¸é‡å¤è¯·æ±‚
  refetchOnWindowFocus: false,   // ç¦ç”¨çª—å£èšç„¦åˆ·æ–°
  refetchOnMount: false,         // ç¦ç”¨æŒ‚è½½æ—¶åˆ·æ–°
  retry: 1,                      // å‡å°‘é‡è¯•æ¬¡æ•°
}
```

#### ğŸ“‹ ç§»é™¤è¿‡åº¦åˆ·æ–°
- ç§»é™¤ `refreshCourseData()` çš„é¢‘ç¹è°ƒç”¨
- å‡å°‘ `invalidateQueries()` ä½¿ç”¨
- ç®€åŒ–ç¼“å­˜ç­–ç•¥

#### âœ… æ£€æµ‹æ–¹æ³•
1. æ‰“å¼€Networké¢æ¿ï¼Œç›‘æ§APIè¯·æ±‚
2. åˆ‡æ¢é¡µé¢æ—¶è¯·æ±‚æ•°é‡ < 3ä¸ª
3. çª—å£èšç„¦æ—¶æ— é¢å¤–è¯·æ±‚

#### ğŸ§ª æµ‹è¯•æ­¥éª¤
1. é¡µé¢åˆ‡æ¢æµ‹è¯•
2. çª—å£èšç„¦/å¤±ç„¦æµ‹è¯•
3. æ•°æ®æ›´æ–°åŠæ—¶æ€§æµ‹è¯•
4. æ€§èƒ½ç›‘æ§ï¼ˆå†…å­˜ä½¿ç”¨ï¼‰

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡
- **å†…å­˜ä½¿ç”¨**ï¼šå‡å°‘ 60-70%
- **ä»£ç é‡**ï¼šå‡å°‘ 50% ä»¥ä¸Š
- **çŠ¶æ€æ•°é‡**ï¼šä» 15+ å‡å°‘è‡³ 6 ä¸ª
- **APIè¯·æ±‚**ï¼šå‡å°‘ 40-50%

### ç»´æŠ¤æ€§æå‡
- **è°ƒè¯•éš¾åº¦**ï¼šå¤§å¹…é™ä½
- **bugå®šä½**ï¼šæ›´å®¹æ˜“
- **æ–°åŠŸèƒ½æ·»åŠ **ï¼šæ›´ç®€å•
- **ä»£ç ç†è§£**ï¼šæ›´ç›´è§‚

### ç”¨æˆ·ä½“éªŒ
- **é¡µé¢å“åº”**ï¼šæ›´å¿«
- **å´©æºƒç‡**ï¼šå¤§å¹…é™ä½
- **ä¿å­˜åé¦ˆ**ï¼šæ›´æ˜ç¡®
- **æ“ä½œæµç•…æ€§**ï¼šæ˜¾è‘—æå‡

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®å®‰å…¨
1. é‡æ„è¿‡ç¨‹ä¸­å®šæœŸå¤‡ä»½æ•°æ®åº“
2. åœ¨å¼€å‘ç¯å¢ƒå……åˆ†æµ‹è¯•
3. ä¿ç•™å›é€€æ–¹æ¡ˆ

### åŠŸèƒ½ä¿è¯
1. æ ¸å¿ƒä¿å­˜åŠŸèƒ½ä¸èƒ½ç ´å
2. ç”¨æˆ·æ•°æ®ä¸èƒ½ä¸¢å¤±
3. ä¿å­˜çŠ¶æ€åé¦ˆè¦å‡†ç¡®

### æ¸è¿›å¼é‡æ„
1. ä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªæ­¥éª¤
2. æ¯æ­¥å®Œæˆåè¿›è¡Œæµ‹è¯•
3. ç¡®è®¤æ— é—®é¢˜å†è¿›è¡Œä¸‹ä¸€æ­¥

---

## ğŸ” éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯
- [ ] åˆ›å»ºæ–°è¯¾ç¨‹
- [ ] ç¼–è¾‘ç°æœ‰è¯¾ç¨‹
- [ ] æ·»åŠ /åˆ é™¤æ¨¡å—
- [ ] æ·»åŠ /åˆ é™¤è¯¾æ—¶
- [ ] ä¿å­˜æˆåŠŸåé¦ˆ
- [ ] ä¿å­˜å¤±è´¥å¤„ç†

### æ€§èƒ½éªŒè¯
- [ ] å†…å­˜ä½¿ç”¨ç›‘æ§
- [ ] APIè¯·æ±‚æ•°é‡
- [ ] é¡µé¢å“åº”é€Ÿåº¦
- [ ] æ— å†…å­˜æ³„æ¼

### ä»£ç è´¨é‡
- [ ] ä»£ç è¡Œæ•°å‡å°‘
- [ ] çŠ¶æ€å¤æ‚åº¦é™ä½
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] TypeScriptç¼–è¯‘é€šè¿‡

é€šè¿‡ä»¥ä¸Šæ­¥éª¤çš„ç³»ç»Ÿæ€§é‡æ„ï¼Œå¯ä»¥å°†å¤æ‚çš„ä¿å­˜é€»è¾‘ç®€åŒ–ä¸ºæ¸…æ™°ã€é«˜æ•ˆã€æ˜“ç»´æŠ¤çš„ä»£ç ç»“æ„ã€‚
