# 项目重构建议

## 整体问题

1. **大型文件过多**：多个组件文件超过300行，增加维护难度
2. **职责不明确**：组件混合了UI、状态管理、API调用等多种功能
3. **代码重复**：缺乏适当的抽象导致逻辑重复
4. **结构不清晰**：项目结构组织不够优化
5. **性能优化空间**：部分组件可能存在性能瓶颈

## 核心组件重构建议

### 1. App.tsx (250+ 行)

**问题**：
- 混合了路由配置、布局逻辑和权限控制
- 功能过于集中

**重构建议**：
- 分离路由配置到独立文件 `src/routes/index.tsx`
- 提取布局组件到 `src/components/layout/`
- 将权限控制逻辑抽象为独立组件 `src/components/auth/ProtectedRoute.tsx`
- 简化主App组件，仅保留主要的应用框架

### 2. BlockNoteEditor.tsx (462 行)

**问题**：
- 包含了本地化配置、编辑器初始化、UI渲染和文件处理等多种职责
- 代码冗长难以维护

**重构建议**：
- 将中文本地化字典提取到 `src/components/editor/locales/zh.ts`
- 分离UI组件：创建 `EditorToolbar.tsx`、`EditorContent.tsx` 等
- 创建自定义Hook: `useBlockNoteEditor.ts` 管理编辑器逻辑
- 将文件上传处理提取到独立的服务 `src/services/fileUploadService.ts`

### 3. AuthContext.tsx (281 行)

**问题**：
- 身份验证逻辑过于复杂
- 包含了缓存管理、API调用和状态处理

**重构建议**：
- 将缓存逻辑提取到 `src/utils/authCache.ts`
- 创建 `src/services/authService.ts` 处理API调用
- 简化上下文提供者，专注于状态管理
- 考虑使用状态机管理身份验证状态

### 4. 各个页面组件 (Dashboard.tsx、Learning.tsx 等)

**问题**：
- 页面组件普遍较大（超过200行）
- 混合了数据获取、状态管理和UI渲染

**重构建议**：
- 使用组合模式分解页面为多个小组件
- 提取数据获取逻辑到自定义Hook，如 `useDashboardData.ts`
- 将UI部分分离为展示型组件

## 项目结构优化

建议采用以下项目结构：

