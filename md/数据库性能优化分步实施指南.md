# æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–åˆ†æ­¥å®æ–½æŒ‡å—

åŸºäºé¡¹ç›®ä»£ç åˆ†æï¼Œæœ¬æŒ‡å—å°†ä¼˜åŒ–æ–¹æ¡ˆåˆ†è§£ä¸ºå…·ä½“çš„å¯æ‰§è¡Œæ­¥éª¤ã€‚

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

**ç›®æ ‡**: è§£å†³æ•°æ®åº“ä¸ç¨³å®šã€è¯¾ç¨‹åŠ è½½ç¼“æ…¢ã€ç¼“å­˜æ— æ•ˆç­‰é—®é¢˜  
**é¢„æœŸæ•ˆæœ**: æŸ¥è¯¢é€Ÿåº¦æå‡60-80%ï¼Œç¼“å­˜å‘½ä¸­ç‡85%+ï¼Œé‡å¤è¯·æ±‚å‡å°‘90%

---

## ğŸš€ é˜¶æ®µä¸€ï¼šç«‹å³æ‰§è¡Œ - æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– (30åˆ†é’Ÿ)

### æ­¥éª¤ 1.1: æ·»åŠ å…³é”®æ•°æ®åº“ç´¢å¼•

**æ‰§è¡Œæ–¹å¼**: ä½¿ç”¨Supabase MCPå·¥å…·æ‰§è¡ŒSQL

```sql
-- ä¸ºcourse_enrollmentsè¡¨æ·»åŠ å¤åˆç´¢å¼• (æœ€å…³é”®)
CREATE INDEX IF NOT EXISTS idx_course_enrollments_user_course 
ON course_enrollments(user_id, course_id);

-- ä¸ºcoursesè¡¨æ·»åŠ çŠ¶æ€å’Œä½œè€…ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_courses_status_author 
ON courses(status, author_id);

-- ä¸ºlessonsè¡¨æ·»åŠ æ¨¡å—å’Œé¡ºåºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_lessons_module_order 
ON lessons(module_id, order_index);

-- ä¸ºcourse_modulesè¡¨æ·»åŠ è¯¾ç¨‹å’Œé¡ºåºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_course_modules_course_order 
ON course_modules(course_id, order_index);

-- ä¸ºlesson_completionsè¡¨æ·»åŠ å¤åˆç´¢å¼• (ä¼˜åŒ–è¿›åº¦æŸ¥è¯¢)
CREATE INDEX IF NOT EXISTS idx_lesson_completions_user_course
ON lesson_completions(user_id, course_id);
```

**éªŒè¯æ–¹æ³•**:
```sql
-- æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT indexname, tablename, indexdef 
FROM pg_indexes 
WHERE tablename IN ('course_enrollments', 'courses', 'lessons', 'course_modules', 'lesson_completions')
AND indexname LIKE 'idx_%';
```

**é¢„æœŸç»“æœ**: åº”è¯¥çœ‹åˆ°5ä¸ªæ–°ç´¢å¼•è¢«åˆ›å»º

### æ­¥éª¤ 1.2: éªŒè¯æ€§èƒ½æ”¹å–„

**æµ‹è¯•æŸ¥è¯¢æ€§èƒ½**:
```sql
-- æµ‹è¯•è¯¾ç¨‹æ³¨å†ŒæŸ¥è¯¢ (æœ€é¢‘ç¹çš„æŸ¥è¯¢)
EXPLAIN ANALYZE 
SELECT id, progress, status 
FROM course_enrollments 
WHERE user_id = 'ä½ çš„ç”¨æˆ·ID' AND course_id = 'æŸä¸ªè¯¾ç¨‹ID';

-- æµ‹è¯•è¯¾ç¨‹æ¨¡å—æŸ¥è¯¢
EXPLAIN ANALYZE 
SELECT * FROM course_modules 
WHERE course_id = 'æŸä¸ªè¯¾ç¨‹ID' 
ORDER BY order_index;
```

**æˆåŠŸæ ‡å¿—**: æŸ¥è¯¢è®¡åˆ’æ˜¾ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«æè€Œä¸æ˜¯å…¨è¡¨æ‰«æ

---

## ğŸ”§ é˜¶æ®µäºŒï¼šå‰ç«¯ç¼“å­˜ç»Ÿä¸€ä¼˜åŒ– (2-3å°æ—¶)

### æ­¥éª¤ 2.1: ç§»é™¤IndexedDBç¼“å­˜å±‚

**æ–‡ä»¶**: `src/lib/indexedDBCache.ts`

**ä¿®æ”¹**:
```typescript
// å®Œå…¨ç¦ç”¨IndexedDBç¼“å­˜çš„è‡ªåŠ¨æ¸…ç†
(function setupAutoCleaning() {
  console.log('IndexedDBç¼“å­˜å·²ç¦ç”¨ - ä½¿ç”¨React Queryä½œä¸ºå”¯ä¸€ç¼“å­˜å±‚');
  // æ³¨é‡Šæ‰æ‰€æœ‰è‡ªåŠ¨æ¸…ç†ä»£ç 
})();

// ä¿®æ”¹ç¼“å­˜æœåŠ¡APIï¼Œè®©æ‰€æœ‰æ–¹æ³•è¿”å›nullæˆ–ç©ºæ“ä½œ
export const indexedDBCache = {
  async saveCourseDetails(courseId: string, data: any): Promise<void> {
    // ç¦ç”¨ï¼šç›´æ¥è¿”å›ï¼Œä¸ä¿å­˜
    return;
  },
  
  async getCourseDetails(courseId: string, maxAge = DEFAULT_CACHE_EXPIRY): Promise<any | null> {
    // ç¦ç”¨ï¼šç›´æ¥è¿”å›nullï¼Œå¼ºåˆ¶ä½¿ç”¨React Query
    return null;
  },
  
  async saveEnrollment(courseId: string, userId: string, data: any): Promise<void> {
    // ç¦ç”¨ï¼šç›´æ¥è¿”å›ï¼Œä¸ä¿å­˜
    return;
  },
  
  async getEnrollment(courseId: string, userId: string, maxAge = DEFAULT_CACHE_EXPIRY): Promise<any | null> {
    // ç¦ç”¨ï¼šç›´æ¥è¿”å›nullï¼Œå¼ºåˆ¶ä½¿ç”¨React Query
    return null;
  },
  
  // å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜ï¼Œä¾›ç®¡ç†é¡µé¢ä½¿ç”¨
  clearCourseCache: (courseId: string) => db.clearCourseCache(courseId),
  clearAllCache: () => db.clearAllCache(),
  clearExpiredCache: (expireTime = DEFAULT_CACHE_EXPIRY) => db.clearExpiredCache(expireTime),
  getCacheStats: () => db.getCacheStats()
};
```

**éªŒè¯**: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œä¸åº”å†çœ‹åˆ°"ä»IndexedDBç¼“å­˜è¿”å›"çš„æ—¥å¿—

### æ­¥éª¤ 2.2: ç§»é™¤localStorageç¼“å­˜

**æ–‡ä»¶**: `src/hooks/useCoursesData.ts`

**ä¿®æ”¹ç¼“å­˜åŠ©æ‰‹å‡½æ•°**:
```typescript
// ç¦ç”¨localStorageç¼“å­˜å‡½æ•°
const getFromLocalCache = (key: string) => {
  // ç¦ç”¨ï¼šç›´æ¥è¿”å›nullï¼Œå¼ºåˆ¶ä½¿ç”¨React Query
  return null;
};

const saveToLocalCache = (key: string, data: any) => {
  // ç¦ç”¨ï¼šç›´æ¥è¿”å›ï¼Œä¸ä¿å­˜
  return;
};
```

**éªŒè¯**: æ£€æŸ¥localStorageï¼Œä¸åº”å†æœ‰æ–°çš„è¯¾ç¨‹ç¼“å­˜é¡¹

### æ­¥éª¤ 2.3: ç»Ÿä¸€React Queryç¼“å­˜é…ç½®

**æ–‡ä»¶**: `src/App.tsx`

**ä¿®æ”¹QueryClienté…ç½®**:
```typescript
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // ç»Ÿä¸€ç¼“å­˜ç­–ç•¥
      staleTime: 5 * 60 * 1000,     // 5åˆ†é’Ÿæ ‡è®°ä¸ºè¿‡æœŸ
      gcTime: 15 * 60 * 1000,       // 15åˆ†é’Ÿåæ¸…ç†
      refetchOnWindowFocus: false,  // ç¦ç”¨çª—å£èšç„¦æ—¶é‡æ–°è·å–
      refetchOnMount: false,        // ç¦ç”¨ç»„ä»¶æŒ‚è½½æ—¶é‡æ–°è·å–
      retry: 1,                     // å¤±è´¥æ—¶æœ€å¤šé‡è¯•1æ¬¡
      retryDelay: 1000,            // é‡è¯•å»¶è¿Ÿ1ç§’
    },
  },
});
```

**æ–‡ä»¶**: `src/pages/course/hooks/useCourseData.ts`

**ç»Ÿä¸€ç¼“å­˜é…ç½®**:
```typescript
const UNIFIED_CACHE_CONFIG = {
  // è¯¾ç¨‹è¯¦æƒ… - è¾ƒé•¿ç¼“å­˜æ—¶é—´
  courseDetails: {
    staleTime: 10 * 60 * 1000,    // 10åˆ†é’Ÿ
    gcTime: 30 * 60 * 1000,       // 30åˆ†é’Ÿ
    retry: 2,
    retryDelay: (attemptIndex: number) => Math.min(1000 * 2 ** attemptIndex, 30000),
    refetchOnWindowFocus: false,
    refetchOnMount: false,
  },
  // æ³¨å†Œä¿¡æ¯ - ä¸­ç­‰ç¼“å­˜æ—¶é—´
  enrollment: {
    staleTime: 5 * 60 * 1000,     // 5åˆ†é’Ÿ
    gcTime: 15 * 60 * 1000,       // 15åˆ†é’Ÿ
    retry: 1,
    retryDelay: 1000,
    refetchOnWindowFocus: false,
    refetchOnMount: false,
  },
  // è¯¾ç¨‹åˆ—è¡¨ - çŸ­ç¼“å­˜æ—¶é—´
  courseList: {
    staleTime: 3 * 60 * 1000,     // 3åˆ†é’Ÿ
    gcTime: 10 * 60 * 1000,       // 10åˆ†é’Ÿ
    retry: 1,
    retryDelay: 1000,
    refetchOnWindowFocus: false,
    refetchOnMount: false,
  }
};

// æ›¿æ¢åŸæœ‰çš„CACHE_CONFIG
const CACHE_CONFIG = UNIFIED_CACHE_CONFIG;
```

**éªŒè¯**: æ£€æŸ¥ç½‘ç»œé¢æ¿ï¼Œç›¸åŒè¯·æ±‚åœ¨ç¼“å­˜æ—¶é—´å†…ä¸åº”é‡å¤å‘é€

### æ­¥éª¤ 2.4: æ¸…ç†å·²æœ‰ç¼“å­˜å†²çª

**ç«‹å³æ‰§è¡Œæ¸…ç†**:
```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œæˆ–æ·»åŠ åˆ°ä»»ä½•é¡µé¢çš„useEffectä¸­
localStorage.clear();
indexedDB.deleteDatabase('ConnectLMS-Cache');
```

**éªŒè¯**: åˆ·æ–°é¡µé¢åï¼Œæ‰€æœ‰è¯·æ±‚éƒ½åº”èµ°ç½‘ç»œï¼Œç„¶åè¢«React Queryç¼“å­˜

---

## ğŸ“Š é˜¶æ®µä¸‰ï¼šæ€§èƒ½ç›‘æ§å’ŒéªŒè¯ (1å°æ—¶)

### æ­¥éª¤ 3.1: æ·»åŠ æ€§èƒ½ç›‘æ§

**æ–‡ä»¶**: `src/hooks/usePerformanceMonitor.ts` (æ–°å»º)

```typescript
import { useEffect, useRef } from 'react';

export const usePerformanceMonitor = (operationName: string, enabled = true) => {
  const startTimeRef = useRef<number>();

  useEffect(() => {
    if (!enabled) return;
    
    startTimeRef.current = performance.now();
    console.log(`ğŸš€ [æ€§èƒ½ç›‘æ§] ${operationName} å¼€å§‹`);
    
    return () => {
      if (startTimeRef.current) {
        const duration = performance.now() - startTimeRef.current;
        console.log(`âœ… [æ€§èƒ½ç›‘æ§] ${operationName} å®Œæˆï¼Œç”¨æ—¶: ${duration.toFixed(2)}ms`);
        
        // è®°å½•åˆ°æ€§èƒ½æ—¥å¿—
        if (window.performance && window.performance.mark) {
          window.performance.mark(`${operationName}-end`);
          window.performance.measure(operationName, `${operationName}-start`, `${operationName}-end`);
        }
      }
    };
  }, [operationName, enabled]);

  const markStart = (customName?: string) => {
    const name = customName || operationName;
    startTimeRef.current = performance.now();
    console.log(`ğŸš€ [æ€§èƒ½ç›‘æ§] ${name} å¼€å§‹`);
  };

  const markEnd = (customName?: string) => {
    if (!startTimeRef.current) return;
    
    const name = customName || operationName;
    const duration = performance.now() - startTimeRef.current;
    console.log(`âœ… [æ€§èƒ½ç›‘æ§] ${name} å®Œæˆï¼Œç”¨æ—¶: ${duration.toFixed(2)}ms`);
    return duration;
  };

  return { markStart, markEnd };
};
```

**æ–‡ä»¶**: `src/pages/course/hooks/useCourseData.ts`

**æ·»åŠ ç›‘æ§**:
```typescript
import { usePerformanceMonitor } from '@/hooks/usePerformanceMonitor';

export const useCourseData = (courseId: string | undefined) => {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  const { markStart, markEnd } = usePerformanceMonitor('CourseData');
  
  // åœ¨fetchCourseDetailsä¸­æ·»åŠ ç›‘æ§
  const fetchCourseDetailsMonitored = async (courseId: string | undefined) => {
    markStart(`è¯¾ç¨‹è¯¦æƒ…-${courseId}`);
    try {
      const result = await fetchCourseDetails(courseId);
      markEnd(`è¯¾ç¨‹è¯¦æƒ…-${courseId}`);
      return result;
    } catch (error) {
      markEnd(`è¯¾ç¨‹è¯¦æƒ…-${courseId}-å¤±è´¥`);
      throw error;
    }
  };

  // ä¿®æ”¹useQuery
  const { 
    data: courseData, 
    isLoading: isLoadingCourse,
    refetch: refetchCourseData,
    error: courseError
  } = useQuery({
    queryKey: ['courseDetails', courseId],
    queryFn: () => fetchCourseDetailsMonitored(courseId),
    enabled: !!courseId,
    ...UNIFIED_CACHE_CONFIG.courseDetails
  });
  
  // ... å…¶ä»–ä»£ç ä¿æŒä¸å˜
};
```

### æ­¥éª¤ 3.2: æ·»åŠ ç¼“å­˜çŠ¶æ€ç›‘æ§

**æ–‡ä»¶**: `src/components/debug/CacheDebugger.tsx` (æ–°å»º)

```typescript
import React from 'react';
import { useQueryClient } from '@tanstack/react-query';

const CacheDebugger: React.FC = () => {
  const queryClient = useQueryClient();
  
  if (process.env.NODE_ENV !== 'development') {
    return null;
  }
  
  const cache = queryClient.getQueryCache();
  const queries = cache.getAll();
  
  const stats = {
    totalQueries: queries.length,
    activeQueries: queries.filter(q => q.isActive()).length,
    staleQueries: queries.filter(q => q.isStale()).length,
    errorQueries: queries.filter(q => q.state.status === 'error').length,
  };
  
  const courseQueries = queries.filter(q => 
    q.queryKey.some(key => 
      typeof key === 'string' && 
      (key.includes('course') || key.includes('enrollment'))
    )
  );
  
  return (
    <div style={{
      position: 'fixed',
      top: 10,
      right: 10,
      background: 'rgba(0,0,0,0.8)',
      color: 'white',
      padding: '10px',
      borderRadius: '5px',
      fontSize: '12px',
      zIndex: 9999,
      maxWidth: '300px'
    }}>
      <h4>ğŸ” ç¼“å­˜è°ƒè¯•å™¨</h4>
      <div>æ€»æŸ¥è¯¢: {stats.totalQueries}</div>
      <div>æ´»è·ƒ: {stats.activeQueries}</div>
      <div>è¿‡æœŸ: {stats.staleQueries}</div>
      <div>é”™è¯¯: {stats.errorQueries}</div>
      
      <h5>è¯¾ç¨‹ç›¸å…³æŸ¥è¯¢:</h5>
      {courseQueries.slice(0, 5).map((query, index) => (
        <div key={index} style={{ fontSize: '10px', marginBottom: '2px' }}>
          {JSON.stringify(query.queryKey)}: {query.state.status}
        </div>
      ))}
    </div>
  );
};

export default CacheDebugger;
```

**æ–‡ä»¶**: `src/App.tsx`

**æ·»åŠ è°ƒè¯•å™¨**:
```typescript
import CacheDebugger from '@/components/debug/CacheDebugger';

const App = () => {
  return (
    <StrictMode>
      <BrowserRouter>
        <QueryClientProvider client={queryClient}>
          <TooltipProvider>
            <ThemeProvider>
              <AuthProvider>
                <Toaster />
                <Sonner />
                <AppRoutes />
                {/* å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºç¼“å­˜è°ƒè¯•å™¨ */}
                <CacheDebugger />
              </AuthProvider>
            </ThemeProvider>
          </TooltipProvider>
        </QueryClientProvider>
      </BrowserRouter>
    </StrictMode>
  );
};
```

---

## ğŸ§ª é˜¶æ®µå››ï¼šæµ‹è¯•å’ŒéªŒè¯ (30åˆ†é’Ÿ)

### æ­¥éª¤ 4.1: æ€§èƒ½åŸºå‡†æµ‹è¯•

**åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ**:
```javascript
// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
localStorage.clear();
sessionStorage.clear();
indexedDB.deleteDatabase('ConnectLMS-Cache');

// åˆ·æ–°é¡µé¢å¹¶æµ‹è¯•
location.reload();

// ç„¶åæµ‹è¯•è¯¾ç¨‹åŠ è½½æ—¶é—´
console.time('è¯¾ç¨‹é¡µé¢åŠ è½½');
// å¯¼èˆªåˆ°è¯¾ç¨‹é¡µé¢
// åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
console.timeEnd('è¯¾ç¨‹é¡µé¢åŠ è½½');

// æµ‹è¯•ç¼“å­˜æ•ˆæœ - ç¬¬äºŒæ¬¡è®¿é—®åº”è¯¥æ›´å¿«
console.time('è¯¾ç¨‹é¡µé¢ç¼“å­˜åŠ è½½');
// å†æ¬¡å¯¼èˆªåˆ°ç›¸åŒè¯¾ç¨‹é¡µé¢
console.timeEnd('è¯¾ç¨‹é¡µé¢ç¼“å­˜åŠ è½½');
```

### æ­¥éª¤ 4.2: æ•°æ®åº“æŸ¥è¯¢éªŒè¯

**ä½¿ç”¨Supabaseæ§åˆ¶å°**:
```sql
-- æ£€æŸ¥æœ€è¿‘çš„æŸ¥è¯¢æ€§èƒ½
SELECT 
  query,
  mean_exec_time,
  calls,
  total_exec_time
FROM pg_stat_statements 
WHERE query LIKE '%course_enrollments%' 
ORDER BY mean_exec_time DESC 
LIMIT 10;
```

### æ­¥éª¤ 4.3: ç½‘ç»œè¯·æ±‚éªŒè¯

**æ£€æŸ¥é¡¹ç›®**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network
2. æ¸…é™¤ç½‘ç»œæ—¥å¿—
3. è®¿é—®è¯¾ç¨‹é¡µé¢
4. ç¡®è®¤æ²¡æœ‰é‡å¤çš„APIè¯·æ±‚
5. åˆ·æ–°é¡µé¢ï¼Œç¡®è®¤è¯·æ±‚è¢«ç¼“å­˜

**æˆåŠŸæ ‡å¿—**:
- ç›¸åŒçš„APIä¸åº”åœ¨5åˆ†é’Ÿå†…é‡å¤è¯·æ±‚
- é¡µé¢åˆ·æ–°åï¼Œå¤§éƒ¨åˆ†è¯·æ±‚åº”è¯¥è¢«ç¼“å­˜
- ç½‘ç»œé¢æ¿æ˜¾ç¤ºçŠ¶æ€ä¸º"cached"æˆ–"304"

---

## ğŸ”§ é˜¶æ®µäº”ï¼šé•¿æœŸä¼˜åŒ– (åç»­å®æ–½)

### æ­¥éª¤ 5.1: å®æ–½æ¸è¿›å¼åŠ è½½

**æ–‡ä»¶**: `src/services/courseService.ts`

**æ·»åŠ åˆ†æ®µåŠ è½½æ–¹æ³•**:
```typescript
// 1. è¯¾ç¨‹åŸºç¡€ä¿¡æ¯ï¼ˆæœ€å°åŒ–åŠ è½½ï¼‰
async getCourseEssentials(courseId: string): Promise<CourseEssentials> {
  const { data, error } = await supabase
    .from("courses")
    .select("id, title, description, cover_image, status, author_id")
    .eq("id", courseId)
    .single();

  if (error) throw error;
  return data;
}

// 2. è¯¾ç¨‹æ¨¡å—æ¦‚è§ˆï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
async getCourseModulesOverview(courseId: string): Promise<ModuleOverview[]> {
  const { data, error } = await supabase
    .from("course_modules")
    .select("id, title, order_index")
    .eq("course_id", courseId)
    .order("order_index");

  if (error) throw error;
  return data || [];
}

// 3. æ¨¡å—è¯¦ç»†å†…å®¹ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
async getModuleDetails(moduleId: string): Promise<ModuleDetails> {
  const { data, error } = await supabase
    .from("lessons")
    .select("id, title, type, order_index, content")
    .eq("module_id", moduleId)
    .order("order_index");

  if (error) throw error;
  return { lessons: data || [] };
}
```

### æ­¥éª¤ 5.2: æ·»åŠ é¢„åŠ è½½ç­–ç•¥

**æ–‡ä»¶**: `src/hooks/usePreloadStrategy.ts` (æ–°å»º)

```typescript
import { useQueryClient } from '@tanstack/react-query';
import { courseService } from '@/services/courseService';

export const usePreloadStrategy = () => {
  const queryClient = useQueryClient();
  
  const preloadCourseData = async (courseId: string) => {
    // é¢„åŠ è½½è¯¾ç¨‹åŸºç¡€ä¿¡æ¯
    queryClient.prefetchQuery({
      queryKey: ['courseEssentials', courseId],
      queryFn: () => courseService.getCourseEssentials(courseId),
      staleTime: 10 * 60 * 1000,
    });
    
    // å»¶è¿Ÿé¢„åŠ è½½æ¨¡å—æ¦‚è§ˆ
    setTimeout(() => {
      queryClient.prefetchQuery({
        queryKey: ['courseModulesOverview', courseId],
        queryFn: () => courseService.getCourseModulesOverview(courseId),
        staleTime: 10 * 60 * 1000,
      });
    }, 1000);
  };
  
  return { preloadCourseData };
};
```

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡å’ŒéªŒè¯æ¸…å•

### æ•°æ®åº“å±‚é¢æŒ‡æ ‡
- [ ] æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´ < 200ms  
- [ ] ç´¢å¼•ä½¿ç”¨ç‡ > 90%
- [ ] è¶…æ—¶é”™è¯¯ç‡ < 1%
- [ ] 504é”™è¯¯åŸºæœ¬æ¶ˆå¤±

### å‰ç«¯ç¼“å­˜æŒ‡æ ‡  
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 85%
- [ ] é‡å¤è¯·æ±‚ç‡ < 5%
- [ ] é¡µé¢é¦–æ¬¡åŠ è½½æ—¶é—´ < 2s
- [ ] é¡µé¢ç¼“å­˜åŠ è½½æ—¶é—´ < 500ms

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- [ ] è¯¾ç¨‹é¡µé¢åŠ è½½ç¨³å®š
- [ ] æ²¡æœ‰æ˜æ˜¾çš„åŠ è½½å¤±è´¥
- [ ] é¡µé¢åˆ‡æ¢æµç•…
- [ ] æ•°æ®ä¸€è‡´æ€§è‰¯å¥½

---

## ğŸš¨ å›æ»šæ–¹æ¡ˆ

### å¦‚æœæ•°æ®åº“ä¼˜åŒ–å‡ºç°é—®é¢˜ï¼š
```sql
-- åˆ é™¤æ·»åŠ çš„ç´¢å¼•
DROP INDEX IF EXISTS idx_course_enrollments_user_course;
DROP INDEX IF EXISTS idx_courses_status_author;
DROP INDEX IF EXISTS idx_lessons_module_order;
DROP INDEX IF EXISTS idx_course_modules_course_order;
DROP INDEX IF EXISTS idx_lesson_completions_user_course;
```

### å¦‚æœå‰ç«¯ç¼“å­˜ä¼˜åŒ–å‡ºç°é—®é¢˜ï¼š
1. æ¢å¤ `src/lib/indexedDBCache.ts` ä¸­çš„ç¼“å­˜é€»è¾‘
2. æ¢å¤ `src/hooks/useCoursesData.ts` ä¸­çš„localStorageç¼“å­˜
3. æ¢å¤ `src/App.tsx` ä¸­çš„åŸå§‹QueryClienté…ç½®

### ç´§æ€¥æ¢å¤å‘½ä»¤ï¼š
```bash
# æ’¤é”€æ‰€æœ‰æœ¬åœ°æ›´æ”¹
git checkout -- .

# æˆ–æ¢å¤åˆ°ç‰¹å®šæäº¤
git reset --hard HEAD~1
```

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

**é˜¶æ®µä¸€ - æ•°æ®åº“ä¼˜åŒ–**
- [ ] æ‰§è¡Œç´¢å¼•åˆ›å»ºSQL
- [ ] éªŒè¯ç´¢å¼•åˆ›å»ºæˆåŠŸ  
- [ ] æµ‹è¯•æŸ¥è¯¢æ€§èƒ½æ”¹å–„
- [ ] æ£€æŸ¥é”™è¯¯æ—¥å¿—å‡å°‘

**é˜¶æ®µäºŒ - ç¼“å­˜ç»Ÿä¸€**
- [ ] ç¦ç”¨IndexedDBç¼“å­˜
- [ ] ç¦ç”¨localStorageç¼“å­˜
- [ ] ç»Ÿä¸€React Queryé…ç½®
- [ ] æ¸…ç†ç°æœ‰ç¼“å­˜å†²çª

**é˜¶æ®µä¸‰ - ç›‘æ§éªŒè¯**
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§ä»£ç 
- [ ] æ·»åŠ ç¼“å­˜çŠ¶æ€è°ƒè¯•å™¨
- [ ] éªŒè¯ç›‘æ§æ•°æ®æ­£å¸¸

**é˜¶æ®µå›› - æµ‹è¯•éªŒè¯**
- [ ] æ‰§è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] éªŒè¯æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] ç¡®è®¤ç½‘ç»œè¯·æ±‚ç¼“å­˜

**é˜¶æ®µäº” - é•¿æœŸä¼˜åŒ–**
- [ ] å®æ–½æ¸è¿›å¼åŠ è½½
- [ ] æ·»åŠ é¢„åŠ è½½ç­–ç•¥
- [ ] æŒç»­ç›‘æ§å’Œè°ƒä¼˜

---

**é¢„è®¡æ€»ç”¨æ—¶**: 4-6å°æ—¶  
**å»ºè®®å®æ–½æ—¶é—´**: ç”¨æˆ·è®¿é—®ä½å³°æœŸ  
**ä¼˜å…ˆçº§**: é˜¶æ®µä¸€å’ŒäºŒä¸ºé«˜ä¼˜å…ˆçº§ï¼Œå¿…é¡»å®Œæˆ

å®Œæˆåæ‚¨çš„LMSç³»ç»Ÿåº”è¯¥æœ‰æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼ğŸ‰ 