
我来帮你分析现有的问答系统代码并提出修改思路。让我先搜索相关的代码结构。

Search files...
现在让我查看更多相关的代码文件来了解当前的数据库结构和数据模型：

Ran tool

Ran tool
让我搜索相关的课程创建和编辑组件，特别是针对问题类型的设置：

Search files...
通过分析代码，我现在可以为你提供一个完整的修改思路。让我总结一下现有系统的结构和需要修改的地方：

## 现有系统分析

通过查看代码，我发现现在的问答系统结构如下：

### 1. 数据结构 (`src/types/course.ts`)
- `QuizQuestionType`: `'multiple_choice' | 'true_false' | 'short_answer'`
- `QuizQuestion` 有一个 `correctOption?: string` 字段，只能存储一个正确答案ID
- `QuizOption` 只有 `id` 和 `text` 字段

### 2. 用户界面
- 题目类型显示为："多选题"、"判断题"、"简答题"
- 但实际上"多选题"使用的是 `radio` 输入，只能选择一个答案
- 学生界面提示："对于选择题，请选择一个正确答案"

### 3. 答案处理逻辑
- 只处理单一答案选择
- 评分逻辑基于单一正确答案匹配

## 修改思路

### 第一阶段：名称修正和数据结构扩展

#### 1. 修改类型定义 (`src/types/course.ts`)
```typescript
// 扩展问题类型
export type QuizQuestionType = 'single_choice' | 'multiple_choice' | 'true_false' | 'short_answer';

// 扩展问题结构
export type QuizQuestion = {
  id: string;
  type: QuizQuestionType;
  text: string;
  options?: QuizOption[];
  correctOption?: string; // 保留用于单选题
  correctOptions?: string[]; // 新增：用于多选题的多个正确答案
  sampleAnswer?: string;
  hint?: string;
  isMultipleCorrect?: boolean; // 新增：标识是否为真正的多选题
  requiredSelections?: number; // 新增：多选题要求选择的数量（可选）
};
```

#### 2. 更新问题类型配置 (`src/components/course/LessonEditor.tsx`)
```typescript
const QUESTION_TYPES: { id: QuizQuestionType, name: string }[] = [
  { id: 'single_choice', name: '单选题' }, // 改名
  { id: 'multiple_choice', name: '多选题' }, // 真正的多选题
  { id: 'true_false', name: '判断题' },
  { id: 'short_answer', name: '简答题' }
];
```

### 第二阶段：编辑器界面修改

#### 1. 课程编辑器 (`src/components/course/LessonEditor.tsx`)
- **单选题设置**：继续使用 radio 按钮选择唯一正确答案
- **多选题设置**：
  - 改用 checkbox 让老师可以选择多个正确答案
  - 添加正确答案数量提示
  - 添加"要求学生选择X个答案"的设置（可选功能）

#### 2. 选项管理逻辑更新
- `setCorrectOption` 函数改名为 `setCorrectAnswer`
- 新增 `toggleCorrectOption` 函数用于多选题的多选管理
- 在问题类型切换时正确处理 `correctOption` 和 `correctOptions` 的转换

### 第三阶段：学生答题界面修改

#### 1. 答题组件 (`src/components/course/lessons/quiz/QuizQuestionItem.tsx`)
- **单选题**：继续使用 `radio` 输入
- **多选题**：改用 `checkbox` 输入
- 添加问题类型提示：
  - 单选题："请选择一个正确答案"
  - 多选题："请选择所有正确答案（共X个正确答案）"或"这是多选题，请选出所有正确答案"

#### 2. 答案选择逻辑更新
- 单选题：保持现有的单选逻辑
- 多选题：修改为数组存储多个选择
  ```typescript
  // 用户答案数据结构需要支持数组
  userAnswers: { [key: string]: string | string[] }
  ```

### 第四阶段：答案验证和评分逻辑

#### 1. 答案验证 (`src/pages/course/components/LessonContent.tsx`)
```typescript
const validateAnswer = (question: QuizQuestion, userAnswer: string | string[]) => {
  if (question.type === 'single_choice' || question.type === 'true_false') {
    return question.correctOption === userAnswer;
  } else if (question.type === 'multiple_choice') {
    if (!Array.isArray(userAnswer) || !Array.isArray(question.correctOptions)) {
      return false;
    }
    // 检查选择的答案是否与正确答案完全匹配
    return userAnswer.sort().join(',') === question.correctOptions.sort().join(',');
  }
  // 简答题逻辑保持不变
  return userAnswer && userAnswer.toString().trim() !== '';
};
```

#### 2. 评分逻辑更新
- 单选题：选对得分，选错不得分
- 多选题：
  - **严格模式**：必须完全选对才得分
  - **部分给分模式**：按正确选择的比例给分（可选实现）

### 第五阶段：向后兼容性处理

#### 1. 数据迁移逻辑
```typescript
const migrateQuestionData = (question: QuizQuestion) => {
  // 如果是旧的 multiple_choice 但只有一个正确答案，转换为 single_choice
  if (question.type === 'multiple_choice' && question.correctOption && !question.correctOptions) {
    return {
      ...question,
      type: 'single_choice' as QuizQuestionType
    };
  }
  return question;
};
```

#### 2. 渐进式升级策略
- 保持旧数据格式的兼容性
- 在编辑时自动转换格式
- 提供批量升级选项

### 第六阶段：用户体验优化

#### 1. 界面提示优化
- 在题目标题显示类型标签："[单选]" / "[多选]" / "[判断]" / "[简答]"
- 多选题增加选择进度提示："已选择 2/4 个答案"
- 添加题目类型图标区分

#### 2. 操作反馈
- 多选题提交时验证是否选择了答案
- 提供"清除选择"按钮
- 选择数量提示

### 数据库考虑

由于问答数据主要存储在课程内容的JSON字段中，不需要修改数据库schema，只需要：
1. 确保JSON存储支持新的数据结构
2. 考虑添加索引优化查询性能（如果需要）

### 实施顺序建议

1. **第一步**：更新类型定义和基础数据结构
2. **第二步**：修改编辑器界面，支持新的问题类型设置
3. **第三步**：更新学生答题界面
4. **第四步**：修改答案验证和评分逻辑
5. **第五步**：添加数据迁移和兼容性处理
6. **第六步**：优化用户体验和界面细节

这样的修改策略可以确保：
- 保持现有功能的稳定性
- 平滑迁移到新的多选题功能
- 向后兼容旧的课程数据
- 为用户提供清晰的问题类型区分
